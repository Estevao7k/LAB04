<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Venda de Ingressos</title>
</head>
<body>
    <nav>
        <ul>
            <li><a href="index.html">Início</a></li>
            <li><a href="cadastro_filmes.html">Cadastro de Filmes</a></li>
            <li><a href="cadastro_salas.html">Cadastro de Salas</a></li>
            <li><a href="cadastro_sessoes.html">Cadastro de Sessões</a></li>
            <li><a href="venda_ingressos.html">Venda de Ingressos</a></li>
            <li><a href="sessoes.html">Sessões Disponíveis</a></li>
        </ul>
    </nav>
    <hr>
    <h1>Venda de Ingressos</h1>
    <form id="form_venda_ingresso">
        <div>
            <label for="sessao">Sessão:</label>
            <select id="sessao" required></select>
        </div>
        <div>
            <label for="nome_cliente">Nome do Cliente:</label>
            <input type="text" id="nome_cliente" required>
        </div>
        <div>
            <label for="cpf">CPF:</label>
            <input type="text" id="cpf" required>
        </div>
        <div>
            <label for="assento">Assento (ex: A10):</label>
            <input type="text" id="assento" required>
        </div>
        <div>
            <label for="tipo_pagamento">Tipo de Pagamento:</label>
            <select id="tipo_pagamento">
                <option value="Cartão">Cartão</option>
                <option value="Pix">Pix</option>
                <option value="Dinheiro">Dinheiro</option>
            </select>
        </div>
        <button type="submit">Confirmar Venda</button>
    </form>

    <script>
        function buscar_por_id(lista, id) {
            for (let i = 0; i < lista.length; i++) {
                if (lista[i].id == id) {
                    return lista[i];
                }
            }
            return null;
        }

        document.addEventListener('DOMContentLoaded', function() {
            const sessoes = JSON.parse(localStorage.getItem('sessoes')) || [];
            const filmes = JSON.parse(localStorage.getItem('filmes')) || [];
            const salas = JSON.parse(localStorage.getItem('salas')) || [];
            const select_sessao = document.getElementById('sessao');

            if (sessoes.length === 0) {
                select_sessao.innerHTML = '<option value="">Nenhuma sessão cadastrada</option>';
            }

            sessoes.forEach(function(sessao) {
                const filme = buscar_por_id(filmes, sessao.filme_id);
                const sala = buscar_por_id(salas, sessao.sala_id);
                
                if (filme && sala) {
                    const option = document.createElement('option');
                    option.value = sessao.id;
                    
                    const data_hora = new Date(sessao.data_hora).toLocaleString('pt-BR');
                    option.textContent = `${filme.titulo} - ${sala.nome_sala} - ${data_hora}`;
                    select_sessao.appendChild(option);
                }
            });

            const url_params = new URLSearchParams(window.location.search);
            const sessao_id_url = url_params.get('sessao_id');
            if (sessao_id_url) {
                select_sessao.value = sessao_id_url;
            }
        });

        document.getElementById('form_venda_ingresso').addEventListener('submit', function(event) {
            event.preventDefault();

            const ingresso = {
                id: Date.now(),
                sessao_id: document.getElementById('sessao').value,
                nome_cliente: document.getElementById('nome_cliente').value,
                cpf: document.getElementById('cpf').value,
                assento: document.getElementById('assento').value,
                tipo_pagamento: document.getElementById('tipo_pagamento').value
            };

            const ingressos = JSON.parse(localStorage.getItem('ingressos')) || [];
            ingressos.push(ingresso);
            localStorage.setItem('ingressos', JSON.stringify(ingressos));

            alert('Ingresso vendido com sucesso!');
            document.getElementById('form_venda_ingresso').reset();
        });
    </script>
</body>
</html>